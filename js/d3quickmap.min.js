function d3QuickMap(){function t(t){return t=t.replace(/,/,"."),!isNaN(parseFloat(t))&&isFinite(t)}d3QuickMap.prototype.drawMap=function(e,a){function n(e,a){if(j.add(k),"us-states"==l?r=topojson.feature(a,a.objects.states).features:"us-counties"==l&&(r=topojson.feature(a,a.objects.counties).features),1==t(j.at(0).get(u))){var n="Lin";L.domain([0,d3.max(k,function(t){return+t[u]})]),M.domain([0,d3.max(k,function(t){return+t[u]})])}else var n="Cat";var s=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){var e=null!=j.get(t.id).get("fullname")?j.get(t.id).get("fullname")+": ":"";return"Lin"==n?'<span class="label">'+e+'</span><span class="value">'+w(j.get(t.id).get(u))+"</span>":'<span class="label">'+e+"</span>"+j.get(t.id).get(u).replace(/\s/g,"")});if(A.call(s),q.selectAll("path").data(r).enter().append("path").attr("d",b).on("mouseover",s.show).on("mouseout",s.hide).attr("class",function(t){return null!=j.get(t.id)?"Lin"==n?M(j.get(t.id).get(u)):j.get(t.id).get(u).replace(/\s/g,""):null}).attr("fill",function(t){return null!=j.get(t.id)?"Lin"==n?L(j.get(t.id).get(u)):D(j.get(t.id).get(u)):null}).attr("id",function(t){return t.id}),"us-counties"==l&&q.append("path").datum(topojson.mesh(a,a.objects.states,function(t,e){return t!==e})).attr("class","states-overlay").attr("d",b).attr("fill","none"),k.forEach(function(t){var e=t[u];null!=e&&""!=e&&(y.hasOwnProperty(e)?y[e]++:y[e]=1)}),p.showLegend===!0){var d=p.type,c=p.showCount;for(var g in y)x.push({name:g,count:y[g]});if("Cat"==n){var m=d3.select("#"+f+" svg").selectAll("svg").data(x).enter().append("g").attr("class","legend");m.append("rect").attr("x",i/2+10).attr("y",function(t,e){return o/2+o/4+20*e}).attr("width",10).attr("height",10).attr("class",function(t){return t.name.replace(/\s/g,"")}).attr("fill",function(t){return D(t.name)}),m.append("text").attr("x",i/2+25).attr("y",function(t,e){return o/2+o/4+20*e+10}).attr("font-size","11px").text(function(t){var e=c===!0?" ("+t.count+")":"";if("default"==d)return t.name.toUpperCase()+e;if("custom"==d)for(ckey in p.customKeys)if(ckey==t.name.toLowerCase())return p.customKeys[ckey]+e;return null})}else if("Lin"==n){var h=d3.max(x,function(t){return+t.name}),v=d3.min(x,function(t){return+t.name}),C=i*F-200,m=d3.select("#"+f).append("div").attr("class","legend-scale").attr("style","background-image: linear-gradient(right,"+L(h)+" 35%, #FFFFFF 100%);background-image: -o-linear-gradient(right, "+L(h)+" 35%,#FFFFFF 100%);background-image: -moz-linear-gradient(right, "+L(h)+" 35%, #FFFFFF 100%);background-image: -webkit-linear-gradient(right, "+L(h)+" 35%, #FFFFFF 100%);background-image: -ms-linear-gradient(right, "+L(h)+" 35%, #FFFFFF 100%);filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='"+L(h)+"', endColorstr='"+L(v)+"'); -ms-filter: 'progid:DXImageTransform.Microsoft.gradient(startColorstr='"+L(h)+"', endColorstr='"+L(v)+"')';left:"+C+"px");m.append("span").attr("class","min").text(w(v)),m.append("span").attr("class","max").text(w(h))}}}Config=Backbone.Model.extend({defaults:{w:800,h:600,bm:"us-states",nf:",",cs:"blue"}});var r,s=new Config({w:a.width,h:a.height,bm:a.mapType,ds:a.dataSource,dp:a.dataPoint,nf:a.numberFormat,cs:a.colorScheme,ls:a.legend}),i=s.get("w"),o=s.get("h"),l=s.get("bm"),d=s.get("ds"),u=s.get("dp"),c=s.get("nf"),g=s.get("cs"),p=s.get("ls"),f=e,m=946,F=i/m,h=d3.geo.albersUsa(),b=d3.geo.path().projection(h),v="../json/us.json",w=d3.format(c),y={},x=[],k=[],C=Backbone.Collection.extend(),j=new C,E={blue:["#EFF3FF","#084594"],red:["#FEE5D9","#99000D"],green:["#EDF8E9","#005A32"],orange:["#FEEDDE","#D94801"],purple:["#F2F0F7","#4A1486"],gray:["#F7F7F7","#252525"]},D=d3.scale.category10(),L=d3.scale.linear().range(E[g]),M=d3.scale.quantize().range(d3.range(9).map(function(t){return"q"+t+"-9"})),A=d3.select("#"+f).append("svg").attr("width",i).attr("height",o),q=A.append("g").attr("id","tiles").attr("transform","scale("+F+","+F+")");queue().defer(d3.json,v).defer(d3.csv,d,function(t){k.push(t)}).await(n)}}